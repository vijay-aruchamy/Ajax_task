<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="ajax.js"></script>
    <link rel="stylesheet" href="style1.css">
</head>

<body>
    <div class="heading">
        <h2 style="color:  rgb(12, 78, 116);">Employee Details</h2>
        <span id="counttable" >Count: 200</span>
        <div >
            <button class="clrbutton" onclick="clear1()">Clear</button>
        </div>
    </div>
    <div class="tablediv">
        <div id="tableWrapper">
        <table>
            <thead>
                 <th>ID</th>
                <th>Title</th>
                <th>Status</th>
                <th>Changes</th>
            </thead>
            <tbody id="displayvalue"></tbody>
        </table>
        </div>
        <img src="empty.png" id="empty">
    </div>
    <script>

        let tableBody = document.getElementById("displayvalue");

        let responsevalue = "";
        if (localStorage.getItem('responsekey')) {

            responsevalue = JSON.parse(localStorage.getItem('responsekey'));
            document.getElementById('counttable').innerHTML=`count: ${responsevalue.length}`;
            for (let i = 0; i < responsevalue.length; i++) {
                let row = document.createElement('tr')
                let id = document.createElement('td')
                id.textContent = responsevalue[i].id;

                id.addEventListener('input', function () {
                    let a = event.target;
                    let r = a.closest('tr')
                    let ind = Array.from(tableBody.children).indexOf(r);
                    responsevalue[ind].id = id.textContent;
                  
                });
                let title = document.createElement('td')
                title.textContent = responsevalue[i].title;

                title.addEventListener('input', function () {
                    let a = event.target;
                    let r = a.closest('tr')
                    let ind = Array.from(tableBody.children).indexOf(r);
                    responsevalue[ind].title = title.textContent;
                    
                });
                let status = document.createElement('td')
                status.textContent = responsevalue[i].completed;

                status.addEventListener('input', function () {
                    let a = event.target;
                    let r = a.closest('tr')
                    let ind = Array.from(tableBody.children).indexOf(r);
                    responsevalue[ind].completed = status.textContent;
                   
                });


                let editbutton = document.createElement('button');
                editbutton.textContent = "Edit";
                editbutton.className = "editbutton";

                editbutton.addEventListener('click', function () {
                    if(editbutton.innerText==='Edit')
                    {
                    editbutton.textContent='Save'
                    title.setAttribute('contenteditable', 'true');
                    status.setAttribute('contenteditable', 'true');
                    row.style.border = ' solid';
                    }
                   else 
                     {
                        editbutton.textContent='Edit'
                        title.setAttribute('contenteditable', 'false');
                       status.setAttribute('contenteditable', 'false');
                         row.style.border='none';
                         updateLocalStorage(responsevalue);
                    }
                  
                })


                let deletebutton = document.createElement('button');
                deletebutton.textContent = "Delete";
                deletebutton.className = "deletebutton";

                deletebutton.addEventListener('click', function (event) {
                    let a = event.target;
                    let r = a.closest('tr')
                    let ind = Array.from(tableBody.children).indexOf(r);
                    responsevalue.splice(ind, 1);
                    updateLocalStorage(responsevalue);
                    row.remove();
                })

                let br = document.createElement('br');
                let br1 = document.createElement('br');
                let buttons = document.createElement('td');
                editbutton.style.marginRight = '10px'
                row.appendChild(id);
                row.appendChild(title);
                row.appendChild(status);
                buttons.appendChild(editbutton);
                buttons.appendChild(deletebutton)
                row.appendChild(buttons);


                tableBody.appendChild(row);
            }
            function updateLocalStorage(data) {
                document.getElementById('counttable').innerHTML=`count: ${responsevalue.length}`;
                localStorage.setItem('responsekey', JSON.stringify(data));
            }

        }


        function clear1() {
            document.getElementById("displayvalue").style.display = "none";
            document.getElementById("empty").style.display = "block";
            responsevalue = "";
            document.getElementById('counttable').innerHTML=`count: ${responsevalue.length}`;
            localStorage.clear();
            loaddata();

        }

    </script>
</body>

</html>